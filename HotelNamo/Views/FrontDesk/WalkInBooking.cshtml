@model HotelNamo.Models.Booking
@{
    Layout = "_FrontDeskLayout";
    ViewData["Title"] = "Walk-in Booking";
}

<div class="container">
    <h2>Walk-in Booking</h2>
    <p>Create a new booking for a walk-in guest</p>

    <form asp-action="WalkInBooking" asp-controller="FrontDesk" method="post">
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Guest Information</h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="GuestName" class="form-label">Guest Name</label>
                            <input asp-for="GuestName" class="form-control" required />
                            <span asp-validation-for="GuestName" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="GuestEmail" class="form-label">Email Address</label>
                            <input asp-for="GuestEmail" class="form-control" type="email" />
                            <span asp-validation-for="GuestEmail" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="GuestPhone" class="form-label">Phone Number</label>
                            <input asp-for="GuestPhone" class="form-control" />
                            <span asp-validation-for="GuestPhone" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Booking Details</h4>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="RoomId" class="form-label">Select Room</label>
                            <select asp-for="RoomId" class="form-select" asp-items="ViewBag.AvailableRooms" required>
                                <option value="">-- Select a Room --</option>
                            </select>
                            <span asp-validation-for="RoomId" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="CheckInDate" class="form-label">Check-in Date</label>
                            <input asp-for="CheckInDate" class="form-control" type="date" value="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                            <span asp-validation-for="CheckInDate" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="CheckOutDate" class="form-label">Check-out Date</label>
                            <input asp-for="CheckOutDate" class="form-control" type="date" value="@DateTime.Now.AddDays(1).ToString("yyyy-MM-dd")" required />
                            <span asp-validation-for="CheckOutDate" class="text-danger"></span>
                        </div>
                        <div class="mb-3">
                            <label asp-for="SpecialRequests" class="form-label">Special Requests</label>
                            <textarea asp-for="SpecialRequests" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" id="checkInNow" name="checkInNow" value="true" />
            <label class="form-check-label" for="checkInNow">Check In Guest Now</label>
        </div>

        <div class="d-flex justify-content-between">
            <a asp-action="Bookings" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-primary">Create Booking</button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Set minimum date for check-in to today
            const today = new Date().toISOString().split('T')[0];
            $('#CheckInDate').attr('min', today);

            // Update check-out min date when check-in changes
            $('#CheckInDate').change(function() {
                const checkInDate = new Date($(this).val());
                const nextDay = new Date(checkInDate);
                nextDay.setDate(checkInDate.getDate() + 1);
                const nextDayFormatted = nextDay.toISOString().split('T')[0];

                $('#CheckOutDate').attr('min', nextDayFormatted);

                // If current check-out date is before new check-in date, update it
                if(new Date($('#CheckOutDate').val()) <= checkInDate) {
                    $('#CheckOutDate').val(nextDayFormatted);
                }
            });
        });
    </script>
}